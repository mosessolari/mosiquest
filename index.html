<!doctype html>
<html>
	<head>
		<link rel="stylesheet" type="text/css" href="styles.css">
		<title>MoSiQuest</title>
	</head>

	<script>

		/* THIS IS THE CANVAS AND BUTTON FUNCTIONALITY -- USER INPUT */

		var bufferIndex = 0;
		var lineBuffer = [];
		var line = [];
		var lineSize = 4;
		var mouseStatus = 0;
		var xprev = 0;
		var yprev = 0;
		var x = 0;
		var y = 0;
		var clearTemp = 0;//this is a flag to see if we are committing to clearing the canvas
		drawCanvas();//init the canvas so the pixel data is white by default

		function mouseUpdate(event) {
			let canvas = document.getElementById("whiteBoard");
			let context = canvas.getContext("2d");
			context.fillStyle = "black";
			context.lineWidth = lineSize;
			xprev = x;
			yprev = y;
			x = event.clientX - canvas.offsetLeft;
		    y = event.clientY - canvas.offsetTop;
		    document.getElementById("X").innerHTML = x;
		    document.getElementById("Y").innerHTML = y;

		    if (mouseStatus == 1) {
		    	context.beginPath();
				context.moveTo(xprev, yprev);
				context.lineTo(x, y);
				context.closePath();
				context.stroke();
				line.push([x, y]);
		    }
		}

		function drawCanvas(flag = 0) {
			let canvas = document.getElementById("whiteBoard");
			let context = canvas.getContext("2d");
			context.fillStyle = "white";
			context.fillRect(0, 0, canvas.width, canvas.height);
			context.fillStyle = "black";
			context.lineWidth = lineSize;

			if (flag != 0) {
				return;
			}

			for (let i = 0; i < bufferIndex; i++) {
				context.beginPath();
				for (let j = 1; j < lineBuffer[i].length; j++) {
					context.moveTo(lineBuffer[i][j-1][0], lineBuffer[i][j-1][1]);
					context.lineTo(lineBuffer[i][j][0], lineBuffer[i][j][1]);
				}
				context.closePath();
				context.stroke();
			}

			updateVars();
		}

		function undoLine() {
			if (clearTemp == 1) {
				drawCanvas();
				clearTemp = 0;
				return;
			}

			if (lineBuffer.length > 0 && bufferIndex > 0) {
				bufferIndex -= 1;
				drawCanvas();
			}
		}

		function redoLine() {
			if (clearTemp == 1) {
				return;
			}

			if (lineBuffer.length > bufferIndex) {
				bufferIndex += 1;
				drawCanvas();
			}
		}

		function clearLine() {
			lineBuffer.push(line);
			line = [];
		}

		function clearAll() {
			clearTemp = 1;
			drawCanvas(1);
		}

		function updateButton(status) {
			mouseStatus = parseInt(status);

			if (clearTemp == 1) {
				bufferIndex = 0;
				lineBuffer = [];
				clearTemp = 0;
			}

			if (mouseStatus == 0) {
				clearLine(event);
				bufferIndex++;
			}
			else if (lineBuffer.length > bufferIndex) {
				lineBuffer.splice(bufferIndex);
			}

			updateVars();
		}

		function updateVars() {
			document.getElementById("clickStatus").innerHTML = mouseStatus;
			document.getElementById("bufferSize").innerHTML = lineBuffer.length;
			document.getElementById("lineIndex").innerHTML = bufferIndex;
		}


		/* THIS IS WHERE THE NEURAL NETWORK FUNCTIONALITY IS */

		function initWeights(dataStream) {
			let weights = [];

			for (let i = 0; i < dataStream.length; i++) {
				weights.push(1/(dataStream[i]*dataStream.length))
			}

			return weights;
		}

		function collapseStream(dataStream, weightarray) {
			let data = 0;

			for (let i = 0; i < dataStream.length; i++) {
				data += dataStream[i]*weightarray[i];
			}

			return data;
		}

		function totalData(dataStream) {
			let data = 0;

			for (let i = 0; i < dataStream.length; i++) {
				data += dataStream[i];
			}

			return data;
		}

		function balancedWeights(dataStream, weightArray, totalStream, guess) {
			let balancedArray = weightArray;

			for (let i = 0; i < dataStream.length; i++) {
				balancedArray[i] += weightArray[i]*dataStream[i]/totalStream;
			}

			return balancedArray;
		}

/*
		function orderData(dataStream) {
			let orderedStream = [dataStream[0]];

			for (let i = 1; i < dataStream.length; i++) {
				if (dataStream[i] > orderedStream[i-1]) {
					orderedStream.push(dataStream[i]);
				}
				else {
					orderedStream.unshift(dataStream[i]);
				}

			}

			return orderedStream;
		}
*/

		/* THIS IS THE ACTUAL GAME */

		var memoryBank = [];//this will be stored as a "best guess" weight matrix and all the names it has been given for that weight matrix as a best guess
		//var enumBank = [];//this will store all the indices of entries that corrolate to a name -- this will help for defragmenting, speeding up learning and allowing the ai to read context -- categories can be found when something is named 2 different things
		var mosiTalking = 0;

		function askMosi() {
			//check if there is any canvas data or else dont do anything
			if (lineBuffer.length == 0 || clearTemp == 1 || mosiTalking == 1) {
				return;
			}

			bufferIndex = 0;
			lineBuffer = [];
			clearTemp = 0;
			drawCanvas();
			updateVars();//make sure we clear everything before we start handling the ai

			document.getElementById("mosiButton").innerHTML = "Tell MoSi";
			document.getElementById("inputText").style.display = "block";
			mosiTalking = 1;//this will enable a dialog mode that will disable the ask mosi button
			canvasData = canvasToData();

			document.getElementById("mosiTextBox").innerHTML = "I was quite literally just born... What is that?";
			
		}

		function canvasToData() {
			let canvas = document.getElementById("whiteBoard");
			let context = canvas.getContext("2d");
			return context.getImageData(0, 0, canvas.width, canvas.height);
		}


	</script>

	<body>

		<!--note that 480 is selected because 2*3*5*(2^5) because iphone 13 has 1170 width onmousedown="mouseDown()" onmouseup="mouseUp()"-->

	    <div class="row">
			<div class="drawingboard">
				<canvas id="whiteBoard" width="480" height="480" onmouseup="updateButton(0)" onmousedown="updateButton(1)" onmousemove="mouseUpdate(event)" style="border:1px solid #000000;"></canvas>
			</div>
			<div class="mosiboard">
				<table>
					<tr>
						<td><img src="mosi.png" alt="MoSi Billionaire on his MoSi Quest" width="200" height="200"></td>
					</tr>
					<tr>
						<td><input id="inputText" type="text" style="display:none"></input></td>
					<tr>
						<td><button id="mosiButton" onclick="askMosi()">Ask MoSi</button></td>
					</tr>
					<tr>
						<td><button type="button" onclick="undoLine()">Undo</button></td>
					</tr>
					<tr>
						<td><button type="button" onclick="redoLine()">Redo</button></td>
					</tr>
					<tr>
						<td><button type="button" onclick="clearAll()">Clear</button></td>
					</tr>
					</tr>
				</table>
			</div>
			<div class="brainboard">
				<div class="typewriter">
					<span id="mosiTextBox">Hello... I love you. :)</span>
				</div>
			</div>
		</div>

		
	    <span>MouseDown: </span><span id="clickStatus">0</span>
	    <span> -- LineWidth: </span><span id="lineThickness">4</span>
	    <span> -- MousePos: (</span><span id="X">0</span><span>, </span><span id="Y">0</span><span>)</span>
	    <span> -- LineCount: </span><span id="bufferSize">0</span>
	    <span> -- BufferIndex: </span><span id="lineIndex">0</span>
	    <span> -- MiscDebug: </span><span id="debugVar">NULL</span>

	</body>
</html>
